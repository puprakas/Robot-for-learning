<!DOCTYPE html>
<html lang="en">
	<head>
		<title>New Media Lab</title>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" crossorigin="anonymous"/>
		<link rel="stylesheet" href="../styles/style.css" >
		<link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@500&display=swap" rel="stylesheet">
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" crossorigin="anonymous"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	</head>
	<body  onload = "followMouse();">
		<div class="curtain">
			<div id="ball"></div>
			<div class="container-fluid main">
				<div class="row">
					<div class="col-8">
						<div class="highlight"></div>
						<div class="board-bg">
							<div class="board">
							</div>
						</div>
						<div id='ball-area'>
							<div class="container available-options">
								<div class="row mt-4">
									<div class=" col-md-2 col-xs-4 mt-3">
										<div class="option red-option"></div>
									</div>
									<div class=" col-md-2 col-xs-4 mt-3">
										<div class="option orange-option"></div>
									</div>
									<div class=" col-md-2 col-xs-4 mt-3">
										<div class="option yellow-option"></div>
									</div>
									<div class=" col-md-2 col-xs-4 mt-3">
										<div class="option green-option"></div>
									</div>
									<div class=" col-md-2 col-xs-4 mt-3">
										<div class="option blue-option"></div>
									</div>
									<div class=" col-md-2 col-xs-4 mt-3">
										<div class="option purple-option"></div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-4">
						<div class="robo-screen">
							<div class="robo-container">
								<div class="robo">
									<div class="robo-eyes">
										<div class="left-eyeball eyeball"></div>
										<div class="right-eyeball eyeball"></div>
									</div>
								</div>
							</div>
							<div class="text-box"><p id='text-area'>placeholder<p></div>
						</div>
						<div id='button-area'>
							<div class="button-area">
								<div id="positive" class="dialogue-btn btn-left">
									<span class="away">Yes</span>
									<span class="over">That is correct!</span>
								</div>
								<div id="negative" class="dialogue-btn btn-right">
									<span class="away">No</span>
									<span class="over">You are wrong!</span>
								</div>
							</div>
						</div>
						<div id='slider-area'>
							<div class="slider-area">
								<input class="range-slider" type="range" min="1" max="100" step="0.1" value="50">
							</div>
						</div>
						<div id='numberinput-area'>
							<div class="numberinput-area">
								<div class="value-button" id="decrease" onclick="decreaseValue()" value="Decrease Value">-</div>
								<input type="number" id="number" disabled value="1" />
								<div class="value-button" id="increase" onclick="increaseValue()" value="Increase Value">+</div>
							</div>
							<div class="numberinput-btn">OK<div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
	<footer>
		<script type="text/javascript">
			$('.curtain').fadeIn(3000)
			var size = 8;
			var board = $('.board');
			var board_state = [
				[0,0,0,0,0,0,0,0],
				[0,0,0,0,0,0,0,0],
				[0,0,0,0,0,0,0,0],
				[0,0,0,0,0,0,0,0],
				[0,0,0,0,0,0,0,0],
				[0,0,0,0,0,0,0,0],
				[0,0,0,0,0,0,0,0],
				[0,0,0,0,0,0,0,0]
			]
			for (var i = 0; i < size * size; i++) {
				board.append('<div id= "square_'+ i +'" class="square"></div>');
				// TODO
				// let x = parseInt(i/size);
				// let y = i%size;
			}
			var slider = $('.range-slider');
			var highlighter = $('.highlight');
			var square_h = parseInt($('.square').css("height").replace(/[^-\d\.]/g, '')) + 0.8;
			var extra_padding = parseInt($('.board-bg').css("padding-top").replace(/[^-\d\.]/g, ''));
			highlighter.css("margin-top", (extra_padding + (square_h * (size / 2))) + 'px');
			slider.bind('input', function(){
				let scale = Math.round(this.value * (size - 1 ) / 100);
				highlighter.css("margin-top", extra_padding + square_h * scale + 'px');
			});
			/*
			var state = 0
			$('#super_button').click(function() {
				if (state==0) {
					$('.button-area').css("display","none")
					$('.slider-area').css("display","inline-block")
					highlighter.css("display","block")
					state=1
				}
				else {
					$('.slider-area').css("display","none")
					highlighter.css("display","none")
					$('.button-area').css("display","flex")
					state=0
				}
			});
			*/
			function increaseValue() {
				var value = parseInt(document.getElementById('number').value, 10);
				value = isNaN(value) ? 0 : value;
				value > 7 ? value = 7 : '';
				value++;
				document.getElementById('number').value = value;
			}
			function decreaseValue() {
				var value = parseInt(document.getElementById('number').value, 10);
				value = isNaN(value) ? 0 : value;
				value < 2 ? value = 2 : '';
				value--;
				document.getElementById('number').value = value;
			}
			var on = document.addEventListener.bind(document);
			var xmouse, ymouse;
			on('mousemove', function (e) {
				xmouse = e.clientX || e.pageX;
				ymouse = e.clientY || e.pageY;
			});
			var ball = $('#ball');
			var x = 0,
			y = 0,
			dx = 0,
			dy = 0,
			key = -1;
			var followMouse = function followMouse() {
				key = requestAnimationFrame(followMouse);
				if(!x || !y) {
					x = xmouse;
					y = ymouse;
				} else {
					dx = (xmouse - x) * 0.125;
					dy = (ymouse - y) * 0.125;
					if(Math.abs(dx) + Math.abs(dy) < 0.1) {
						x = xmouse;
						y = ymouse;
					} else {
						x += dx;
						y += dy;
					}
				}
				x = x + 50 > $( document ).width() ? $( document ).width() - 50  : x;
				y = y + 50 > $( document ).height() ? $( document ).height() - 50 : y;
				ball.css("left", x + 'px');
				ball.css("top", y + 'px');
			};
			var picked = false;
			$('.option').click(function() {
				ball.removeClass();
				ball.css('display', 'block');
				ball.addClass(this.className.split(/\s+/)[1]);
				picked = true;
			})
			// HELPERS
			var colour_dict = {
				0:'white',
				1:'red',
				2:'orange',
				3:'yellow',
				4:'green',
				5:'blue',
				6:'purple'
			}
			var target_img = [
				[2,2,2,2,2,2,2,2],
				[2,1,1,1,1,1,1,2],
				[2,1,1,1,1,1,1,2],
				[2,0,0,0,0,0,0,2],
				[2,0,0,0,0,0,0,2],
				[2,5,5,5,5,5,5,2],
				[2,5,5,5,5,5,5,2],
				[2,2,2,2,2,2,2,2]
			]
			function boardComplete(target_img) {
				//return board_state.toString() == target_img.toString()
				
				for (j=0;j<size;j++) {
					for (i=0;i<size;i++) {
						if (target_img[i][j] != board_state[i][j])
							return false
						}
				}
				return true
			}
			function rowOccupied(x) {
				var sum = 0;
				for (var i = 0; i < board_state.length; i++) {
					for (var j = 0; j < board_state[i].length; j++) {
						sum += board_state[i][j];
					}
				}
				return sum;
			}
			function getKeyByValue(object, value) {
				return Object.keys(object).find(key => object[key] === value);
			}
			function squareOccupied(x, y) {
				return board_state[x][y] != 0
			}
			function getRandomNumber(min, max) {
				return parseInt(Math.random() * (max - min) + min);
			}
			function getButtons() {
				return $('#button-area')
			}
			function getSlider() {
				return $('#slider-area')
			}
			function getNumberInput() {
				return $('#numberinput-area')
			}
			function getBalls() {
				return $('#ball-area')
			}
			function highlightRow(x) {
				var highlighter = $('.highlight');
				var square_h = parseInt($('.square').css("height").replace(/[^-\d\.]/g, '')) + 0.8;
				var extra_padding = parseInt($('.board-bg').css("padding-top").replace(/[^-\d\.]/g, ''));
				highlighter.css("margin-top", extra_padding + square_h * x + 'px');
				highlighter.css("display", 'block');
			}
			function roboQuest(text, type = -1) {
				switch(type){
					case -1:
						$('#button-area').fadeOut(2000)
						$('#numberinput-area').fadeOut(2000)
						$('#ball-area').fadeOut(2000)
						break;
					case 0:
						$('#button-area').fadeIn(2000)
						break
					case 1:
						$('#numberinput-area').fadeIn(2000)
						break
					case 2:
						$('#ball-area').fadeIn(2000)
						break
				}
				$('#text-area').text(text) // to placeholder
			}
			// logic :
			var state = 0
			if (state == 0) {
				var current_row = getRandomNumber(0, 8)
				while(rowOccupied(current_row)) { // FIX
					current_row = getRandomNumber(0, 8)
				}
				p = getRandomNumber(-1, 3)
				p = p == 2 ? 0 : p
				p = current_row + p > 8 || current_row + p < 1 ? 0 : p
				highlightRow(current_row)
				roboQuest('i think its row number ' + (current_row + p + 1) + '. Do you think so too?', 0)
				//p=1 //FOR TESTING
				console.log('p'+p)
				if(p!=0) {
					var robo_trials = 0
					$('#positive').click( function() {
						$('#button-area').fadeOut(2000)
						roboQuest('oh shit i was wrong (so you are wrong!)\n which row do you think this is?', 1)
					})
					$('#negative').click( function() {
						console.log('!')
						$('#button-area').fadeOut(2000)
						roboQuest('oh shit nigga you are right that is not row '+ ( current_row  + p ) +'. which row do you think this is?', 1)
					})
					console.log(current_row)
					$('.numberinput-btn').click(function() {
						console.log($('#number').val())
						if($('#number').val()==current_row) {
							roboQuest('you are right kid')
							console.log('true')
							//sleep
							insideRow()
						}
						else{
							roboQuest('')
							roboQuest('you are wrong kid. try again', 1)
							console.log('wrong')
						}
					})
				}
				else {
					$('#positive').click( function() {
						$('#button-area').fadeOut(2000)
						roboQuest('Yes we agree! this is indeed row ' + (current_row + 1))
						insideRow()
						console.log('state ' +state)
					})
					$('#negative').click( function() {
						$('#button-area').fadeOut(2000)
						roboQuest('YOU ARE WRONG KID I WAS TROLLING')
					})
				}
			}
			function insideRow(){
				var current_col = getRandomNumber(0, 8)
				var colour_key = getRandomNumber(1, 7)
				$('.highlight').css ('display','none')
				$('#text-area').text('Place the ' + colour_dict[colour_key] + ' ball in the ' + (current_col + 1) + 'th position of the ' + (current_row + 1) + ' row')
				$('#ball-area').fadeIn(2000)
				$('.square').click(function() {
					if(picked) {
						if ($('#'+this.id).attr('class').split(' ').length > 1) {
							$('#'+this.id).removeClass($('#'+this.id).attr('class').split(' ').pop());
						}
						$('#'+this.id).addClass(ball.attr('class'));
						var pickedKeyColour = getKeyByValue(colour_dict, ball.attr('class').split('-')[0])
						ball.css('display', 'none');
						ball.removeClass();
						if(colour_key == pickedKeyColour) {
							if(current_row != parseInt(this.id.split('_')[1]/8)) {
								$('#text-area').text('Kid misclicked')
							}
							else {
								if(current_col == this.id.split('_')[1]%8) {
									//continue
									alert('1')
								}
								else {
									alert('2')

								}
							}
						}
						else {
							alert('3')
						}
					}
					else {
						//LOCK?
						if ($('#'+this.id).attr('class').split(' ').length > 1) {
							$('#'+this.id).removeClass($('#'+this.id).attr('class').split(' ').pop());
						}
					}
				});
				/*
				if ball placed::
				square correct?
				colour correct?
				if color picked == color requested
				*/
			}
			
			
		</script>
	</footer>
</html>